name: PHP Composer

on:
  push:
    branches: [ "test" ]
  pull_request:
    branches: [ "test" ]

permissions:
  contents: read

#env:
#  BRANCH_NAME: pipeline

jobs:
  build:

    runs-on: ubuntu-latest

    permissions: write-all

    steps:
    - uses: actions/checkout@v3

    - name: Git setup
      run: |
        lsb_release -a
        sudo apt install git
        git --version
        which git
        git config --global user.email "pipeline@github.com"
        git config --global user.name "pipeline"

    - name: Make changes
      run: |
        echo "${{vars}}"
        echo $vars
        echo $vars.PIPELINE_BRANCH_NAME
        git branch -D pipeline || true
        git checkout -b $vars.PIPELINE_BRANCH_NAME
        echo "test" >> test
        git add .
        git commit -m "commit from pipeline"
        git push --set-upstream origin $vars.PIPELINE_BRANCH_NAME

    - name: Cache dependencies
      uses: actions/cache@v3
      with:
        path: |
          ~/bin/git


